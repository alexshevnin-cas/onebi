# План митинга: BI Dashboard Framework
**Длительность:** 60 минут
**Участники:** Аналитик, Фронтендер, Ты (ведущий)

---

## 0:00–0:05 | Контекст и цель

**Что говоришь:**
> "У нас есть задача — давать аналитику внешним клиентам. Не внутренним пользователям, а кастомерам нашего продукта. Сегодня обсудим как это сделать и какая роль у каждого."

**Ключевой тезис:**
> "Мы не можем использовать Superset/Looker/Metabase для внешних клиентов. Причины:"

| Проблема | Почему критично |
|----------|-----------------|
| Лицензирование | Superset бесплатный, но embedded-версия (встраивание в продукт) требует инфраструктуры, своей auth-системы. Looker/Tableau — платные лицензии per seat |
| Брендинг | Клиент видит интерфейс Superset, не наш продукт. White-label либо невозможен, либо дорогой |
| Доступы | Надо давать клиентам аккаунты в нашем Superset. Безопасность, изоляция данных — головная боль |
| UX | Superset — инструмент для аналитиков. Для конечного пользователя слишком сложный |

**Вывод:**
> "Нам нужен свой фронтенд который встраивается в продукт, выглядит как наш продукт, и показывает данные которые мы контролируем."

---

## 0:05–0:15 | Демо прототипа

**Показываешь onebi на localhost:5173/onebi/**

Что показать:
1. Фильтры — кликаешь на чип, выбираешь значение
2. Разбивки — добавляешь разбивку по версии, данные разворачиваются
3. Метрики — выбираешь какие колонки показывать
4. Виды — таблица, bar chart, line chart

**Что говоришь:**
> "Это прототип на фейковых данных. Посмотрите на UI — тут нет ничего необычного: таблица, графики, чипы-фильтры. Стандартные компоненты."

**Вопрос к обоим:**
> "Что из этого выглядит сложным для реализации?"

(Скорее всего ответ — ничего. Это и есть цель вопроса.)

---

## 0:15–0:30 | Блок для фронтендера

### Главный тезис:
> "Мы не делаем кастомную систему визуализации. Мы берём готовые библиотеки и собираем из них дашборд."

### Какие фреймворки/библиотеки использовать:

**Для графиков (выбрать один):**

| Библиотека | Плюсы | Минусы |
|------------|-------|--------|
| **Recharts** | Простой API, хорошая документация, популярный | Базовый функционал |
| **Tremor** | Готовые BI-компоненты (KPI cards, charts, tables) — почти конструктор | Меньше гибкости в кастомизации |
| **Nivo** | Красивые анимации, много типов графиков | Сложнее API |
| **Apache ECharts** | Мощный, много возможностей | Тяжелее, китайская документация |
| **Chart.js** | Проверенный, легкий | Менее "реактивный" |

**Рекомендация для вашего кейса:**
> **Tremor** — создан именно для дашбордов. Из коробки: карточки с метриками, таблицы, графики, фильтры. Кастомизация цветов через Tailwind.

```jsx
// Пример Tremor - это весь код для карточки с метрикой
import { Card, Metric, Text } from "@tremor/react";

<Card>
  <Text>DAU</Text>
  <Metric>12,450</Metric>
</Card>
```

**Для таблиц:**
- **TanStack Table** — headless, полный контроль над UI
- **AG Grid** (community) — мощный, но тяжелее

### Что нужно от фронта:

1. Компонент фильтров (чипы с dropdown)
2. Компонент таблицы с сортировкой
3. Компоненты графиков (bar, line)
4. Layout страницы

**Данные приходят в простом формате:**
```json
{
  "filters": {
    "apps": ["puzzle", "idle", "stack"],
    "periods": ["2025-08", "2025-09", "2025-10"],
    "versions": ["1.2.0", "1.1.9", "1.1.8"]
  },
  "data": [
    {"period": "2025-10", "app": "puzzle", "dau": 12450, "sessions": 45200, ...},
    {"period": "2025-10", "app": "idle", "dau": 8900, "sessions": 31000, ...}
  ]
}
```

**Брендбук:**
> "Цвета, шрифты, скругления — всё через CSS/Tailwind переменные. Один раз настроил — везде применилось."

---

## 0:30–0:45 | Блок для аналитика

### Главный тезис:
> "Твоя задача — не строить дата-платформу с нуля. Твоя задача — сделать вьюхи которые отдают данные в нужном формате. Как ты делаешь датасеты для Superset, только проще."

### Архитектура (простая схема):

```
[Источники]     [Твоя зона]              [Фронт]
     ↓               ↓                       ↓
Raw Data  →  ETL  →  Views/Tables  →  API  →  UI
                         ↑
                   Тут ты решаешь:
                   - Как считать метрики
                   - Как агрегировать
                   - Какие разрезы доступны
```

### Почему это лучше чем Superset для тебя:

| В Superset | В нашем подходе |
|------------|-----------------|
| Логика размазана: часть в SQL, часть в метриках Superset, часть в фильтрах | Вся логика в одном месте — во вьюхах |
| Меняешь формулу → надо править в нескольких местах | Поменял вьюху → везде обновилось |
| Ограничен возможностями Superset | Ты решаешь что возможно |
| Дебажить сложно — где ошибка: в Superset или в данных? | Данные проверяешь отдельно, UI отдельно |

### Конкретный пример вьюхи:

```sql
-- view: dashboard_metrics
SELECT
    date_trunc('month', event_date) as period,
    app_id,
    app_version,
    sdk_version,

    -- Метрики (ты контролируешь формулы)
    count(distinct user_id) as dau,
    count(*) as sessions,

    -- Retention (твоя логика)
    count(distinct case when days_since_install = 1 then user_id end)::float /
    nullif(count(distinct case when days_since_install = 0 then user_id end), 0) as d1_retention,

    -- И так далее...

FROM events
GROUP BY 1, 2, 3, 4
```

**Фронт получает:**
```json
[
  {"period": "2025-10", "app_id": "puzzle", "app_version": "1.2.0", "dau": 12450, "d1_retention": 0.42, ...}
]
```

### Что нужно от аналитика:

1. **Схема данных** — какие метрики, какие разрезы (dimensions)
2. **Вьюхи** — SQL который это считает
3. **Документация** — что как считается (для себя же потом)

**Важно:**
> "Ты не программируешь API. Ты делаешь вьюхи, бэкенд просто читает их и отдаёт JSON."

---

## 0:45–0:55 | Обсуждение и вопросы

**Вопросы для обсуждения:**

1. **К аналитику:** "Какие метрики нужны в первой версии? Давай начнём с минимума."

2. **К фронтендеру:** "Tremor подходит или предпочитаешь другую библиотеку?"

3. **К обоим:** "Какие разрезы (фильтры) нужны? Период, приложение, версия — что ещё?"

**Если аналитик сомневается:**
> "Давай так: ты делаешь одну вьюху для одного дашборда. Смотрим как работает. Если что-то не так — обсуждаем и меняем. Это не высечено в камне."

**Если фронтендер сомневается:**
> "Посмотри Tremor — там готовые примеры дашбордов. Если что-то не подходит — скажи, обсудим альтернативы."

---

## 0:55–1:00 | Следующие шаги

**Фиксируем:**

| Кто | Что делает | К когда |
|-----|------------|---------|
| Аналитик | Список метрик и разрезов для первого дашборда | [дата] |
| Аналитик | Драфт первой вьюхи (можно без данных, просто SQL) | [дата] |
| Фронтендер | Посмотреть Tremor, сказать подходит или нет | [дата] |
| Фронтендер | Накидать скелет компонентов (можно с моками) | [дата] |
| Ты | API endpoint который читает вьюху | [дата] |

**Закрывающий тезис:**
> "Мы не делаем rocket science. Таблица, графики, фильтры — всё стандартное. Разница только в том, что это наш продукт, наш бренд, наш контроль. И клиенты видят профессиональный инструмент, а не 'зайдите в наш Superset'."

---

## Шпаргалка: если будут возражения

| Возражение | Ответ |
|------------|-------|
| "В Superset это уже есть" | "Для внутреннего использования — да. Для продукта клиентам — нет. Мы не можем встроить Superset в наш UI и брендировать его." |
| "Это долго делать" | "Первая версия — одна вьюха, одна страница. Потом итерируем. Tremor ускоряет фронт в разы." |
| "А если формулы поменяются?" | "Меняешь вьюху — данные обновились везде. Проще чем в Superset где надо править в нескольких местах." |
| "Я не знаю как делать API" | "API — не твоя задача. Ты делаешь вьюхи, бэкенд читает их." |
